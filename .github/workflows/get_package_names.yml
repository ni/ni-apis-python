name: Get package names

on:
  workflow_call:
    outputs:
      package-names:
        description: "List of package names from packages.json"
        value: ${{ jobs.get_package_names.outputs.package-names }}

jobs:
  get_package_names:
    name: Get package names
    runs-on: ubuntu-latest
    outputs:
      package-names: ${{ steps.parse_json.outputs.package-names }}
    steps:
      - name: Check out repo
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1
      - name: Get package info from JSON
        id: parse_json
        # NOTE: jq only supports standard JSON, not JSONC or JSON5
        run: |
          info=$(jq -c 'keys' ./packages.json)
          if [ -z "$info" ] || [ "$info" = "[]" ]; then
            echo "Error: No package names found in packages.json" >&2
            exit 1
          fi
          echo "Package names: $info"
          echo "package-names=$info" >> $GITHUB_OUTPUT
