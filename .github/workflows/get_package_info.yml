name: Get package info

on:
  workflow_call:
    inputs:
      package-name:
        description: 'The name of the package to check.'
        default: ''
        required: true
        type: string
    outputs:
      proto-basepath:
        description: 'Base path for proto files.'
        value: ${{ jobs.get_package_info.outputs.proto-basepath }}
      proto-subpath:
        description: 'Subpath for proto files.'
        value: ${{ jobs.get_package_info.outputs.proto-subpath }}
      proto-include-path:
        description: 'Include path for proto files.'
        value: ${{ jobs.get_package_info.outputs.proto-include-path }}
      output-format:
        description: 'Output format.'
        value: ${{ jobs.get_package_info.outputs.output-format }}

jobs:
  get_package_info:
    name: Get package info for ${{ inputs.package-name }}
    runs-on: ubuntu-latest
    outputs:
      proto-basepath: ${{ steps.parse_json.outputs.proto-basepath }}
      proto-subpath: ${{ steps.parse_json.outputs.proto-subpath }}
      proto-include-path: ${{ steps.parse_json.outputs.proto-include-path }}
      output-format: ${{ steps.parse_json.outputs.output-format }}
    steps:
      - name: Check out repo
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - name: Get package info from JSON
        id: parse_json
        run: |
          info=$(jq -c --arg name "${{ inputs.package-name }}" '.[$name]' "./packages.json")
          if [ "$info" = "null" ]; then
            echo "Error: Package '${{ inputs.package-name }}' not found in JSON file." >&2
            exit 1
          fi
          echo "Package info: $info"
          echo "proto-basepath=$(echo $info | jq -r '."proto-basepath"')" >> $GITHUB_OUTPUT
          echo "proto-subpath=$(echo $info | jq -r '."proto-subpath"')" >> $GITHUB_OUTPUT
          echo "proto-include-path=$(echo $info | jq -r '."proto-include-path"')" >> $GITHUB_OUTPUT
          echo "output-format=$(echo $info | jq -r '."output-format"')" >> $GITHUB_OUTPUT
